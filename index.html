<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products3</title>
    <style>
        body{
            background-color: rgb(63, 101, 206);
        }
        #loadBtn{
            background-color: rgb(145, 237, 237);
            border: none;
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            font-size: 30px;
        }
        .product{
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        }
        .name{
            font-weight: bolder;
            font-size: 30px;
        }
        .desc{
            font-style: italic;
        }
        #result{
            display: flex;
            justify-content: space-between;
        }
        #matches{
            font-size: 30px;
            color: rgb(145, 237, 237);
            font-weight: bolder;
        }
        #catLabel{
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            font-size: 30px;
            color: white;
        }
        #categorySelect{
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            font-size: 20px;
            background-color: rgb(201, 250, 250);
        }
        #filterBtn{
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            background-color: rgb(145, 237, 237);
            border: 2px;
            border-radius: 30%;
            font-size: 20px;
        }
        #title{
            font-size: 50px;
            text-align: center;
            color: rgb(145, 237, 237);
            font-weight: bolder;
        }
        #instructions{
            font-size: 25px;
            text-align: center;
            color: white;
        }
        hr{
            height: 10px;
            color: black;
        }
        #products-info{
            color: white;
        }
    </style>
</head>
<body>
    <div id="title">Our Shop</div>
    <hr>
    <div id="instructions">
        <b>How to use:</b><br>1. Read data for list of items<br>2. Filter for a specific category
    </div>
    <hr>
    <div id="result">
        <div class="read">    
            <button id="loadBtn">Read Data</button>
            <div id="products-info"></div>
        </div>
        <div class="categories">
            <label for="categorySelect" id="catLabel">Category:</label>
            <select id="categorySelect">
                <option value="">choose a category</option>
            </select>
            <button id="filterBtn">Filter Data</button>
            <div id="matches"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        let allProducts = [];
        let allCategories = [];

        $("#loadBtn").on("click", function(){
            const req = new XMLHttpRequest();
            req.open("GET", "https://rimbadaoui.github.io/products3-JSON/products.json", true); 
            req.onreadystatechange = function() {
                if (this.readyState === 4 && this.status === 200) {
                    allProducts = JSON.parse(this.responseText);
                    const container = document.getElementById("products-info");
                    
                    allCategories = [...new Set(allProducts.flatMap(p => p.categories))];

                    allProducts.forEach(product => {
                        const cats = product.categories.join(", ");
                        container.innerHTML += `
                        <h3>${product.name}</h3>
                        <p>Description: ${product.description}</p>
                        <p>Categories: ${cats}</p>
                        <p>Price: $${product.price}</p>
                        `;
                    });

                    const dropdown = document.getElementById("categorySelect");
                    dropdown.innerHTML = "choose a category";
                    allCategories.forEach(cat => {
                        const opt = document.createElement("option");
                        opt.value = cat;
                        opt.textContent = cat;
                        dropdown.appendChild(opt);
                    });



                }
            };
            req.send();
        });

        // let catsLoaded = false;
        // $("#categorySelect").on("click", function(){
        //         if (catsLoaded) return;
        //         //create a set of categories (no repeats) and add the categories of each item
        //         // const catsSet = new Set();
        //         // products.forEach(product => {
        //         //     const cats = product.categories;
        //         //     cats.forEach(cat => catsSet.add(cat));
        //         // });

        //         //update options
        //         let html = "<option value='default'>choose a category</option>";
        //         allCategories.forEach(cat => {
        //             html += '<option value="' + cat + '">' + cat + '</option>'  
        //         });
        //         document.getElementById("categorySelect").innerHTML = html;

        //         catsLoaded = true;

        //     // });

           
        // });

        $("#filterBtn").on("click", function () {
            const chosen = $("#categorySelect").val();
            if (!chosen){
                const allProductNames = products.map(p => '<span class="pName">' + p.name + '</span>');
                $("#matches").html(allProductNames);
                return;
            }
            const filteredData = allProducts.filter(p => p.categories.includes(chosen));
            const html = filteredData.map(p => '<span class="pName">' + p.name + '</span>').join("<br>");
            $("#matches").html(html || "no matches");
        });
    </script>
</body>
</html>
